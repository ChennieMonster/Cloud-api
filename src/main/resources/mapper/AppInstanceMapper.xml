<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cloud.api.mapper.AppInstanceMapper">

	<resultMap id="BaseResultMap" type="com.cloud.api.dto.AppInstanceDTO">
		<result column="uuid" jdbcType="VARCHAR" property="uuid" />
		<result column="name" jdbcType="VARCHAR" property="name" />
		<result column="display_name" jdbcType="VARCHAR" property="displayName" />
		<result column="description" jdbcType="VARCHAR" property="description" />
		<result column="last_version" jdbcType="VARCHAR" property="lastVersion" />
		<result column="status" jdbcType="VARCHAR" property="status" />
		<result column="trigger" jdbcType="VARCHAR" property="trigger" />
		<result column="template_id" jdbcType="VARCHAR" property="templateId" />
		<result column="application_id" jdbcType="VARCHAR" property="applicationId" />
		<result column="created_time" jdbcType="TIMESTAMP" property="createdTime" />
		<result column="updated_time" jdbcType="TIMESTAMP" property="updatedTime" />
		<result column="objects" jdbcType="VARCHAR" property="objects" />
	</resultMap>
	
	<sql id="Example_Where_Clause">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<where>
			<foreach collection="oredCriteria" item="criteria"
				separator="or">
				<if test="criteria.valid">
					<trim prefix="(" prefixOverrides="and" suffix=")">
						<foreach collection="criteria.criteria" item="criterion">
							<choose>
								<when test="criterion.noValue">
									and ${criterion.condition}
								</when>
								<when test="criterion.singleValue">
									and ${criterion.condition} #{criterion.value}
								</when>
								<when test="criterion.betweenValue">
									and ${criterion.condition} #{criterion.value} and
									#{criterion.secondValue}
								</when>
								<when test="criterion.listValue">
									and ${criterion.condition}
									<foreach close=")" collection="criterion.value"
										item="listItem" open="(" separator=",">
										#{listItem}
									</foreach>
								</when>
							</choose>
						</foreach>
					</trim>
				</if>
			</foreach>
		</where>
	</sql>

	<sql id="Base_Column_List" >
    uuid, name, last_version,display_name,description, status, triggers,template_id, application_id, created_time, updated_time, objects
    </sql>

	<select id="queryAppInstanceList" parameterType="java.lang.String" resultMap="BaseResultMap">
		select <include refid="Base_Column_List" /> from instance where sRegistryType = #{sRegistryType,jdbcType=VARCHAR}
	</select>
	
	<select id="queryByTemplateId" parameterType="java.lang.String" resultMap="BaseResultMap">
		select <include refid="Base_Column_List" /> from instance where template_id = #{templateId,jdbcType=VARCHAR}
	</select>
	
	<select id="queryByApplicationId" parameterType="java.lang.String" resultMap="BaseResultMap">
		select <include refid="Base_Column_List" /> from instance where application_id = #{applicationId,jdbcType=VARCHAR}
	</select>
	
	<select id="queryByName" parameterType="java.lang.String" resultMap="BaseResultMap">
		select <include refid="Base_Column_List" /> from instance where name = #{name,jdbcType=VARCHAR}
	</select>
	
	<select id="queryById" parameterType="java.lang.String" resultMap="BaseResultMap">
		select <include refid="Base_Column_List" /> from instance where uuid = #{uuid,jdbcType=VARCHAR}
	</select>

	<insert id="insertAppInstance" parameterType="com.cloud.api.dto.AppInstanceDTO">
		insert into instance (uuid, name, display_name,description,template_id, application_id, created_time,objects)
		values (#{uuid,jdbcType=VARCHAR},#{name,jdbcType=VARCHAR},#{displayName,jdbcType=VARCHAR},#{description,jdbcType=VARCHAR},#{templateId,jdbcType=VARCHAR},
				  #{applicationId,jdbcType=VARCHAR}, #{createdTime,jdbcType=TIMESTAMP},#{objects,jdbcType=VARCHAR})
	</insert>
	
	<delete id="deleteAppInstance" parameterType="java.lang.String">
		delete from instance where uuid = #{uuid,jdbcType=VARCHAR}
	</delete>
	
	<delete id="deleteAppInstances" parameterType="java.util.List">
		delete from instance where uuid in
		<foreach collection="list" index="index" item="ids" open="("
			separator="," close=")">
			#{ids}
		</foreach>
	</delete>
	
	<update id="updateAppInstanceByAppId" parameterType="com.cloud.api.dto.AppInstanceDTO">
		update instance set display_name = #{displayName,jdbcType=VARCHAR},
		description = #{description,jdbcType=VARCHAR}
		<if test="updatedTime != null ">
				 ,updated_time = #{updatedTime,jdbcType=TIMESTAMP}
		</if>
		<if test="lastVersion != null and lastVersion !=''">
				 ,last_version = #{lastVersion,jdbcType=VARCHAR}
		</if>
		<if test="status != null and status !=''">
				 ,status = #{status,jdbcType=VARCHAR}
		</if>
		<if test="trigger != null and trigger !=''">
				 ,trigger = #{trigger,jdbcType=VARCHAR}
		</if>
		<if test="objects != null and objects !=''">
				 ,objects = #{objects,jdbcType=VARCHAR}
		</if>
		where application_id = #{applicationId,jdbcType=VARCHAR}
	</update>
	
	<update id="updateAppInstanceByTempId" parameterType="com.cloud.api.dto.AppInstanceDTO">
		update instance set display_name = #{displayName,jdbcType=VARCHAR},
		description = #{description,jdbcType=VARCHAR}
		<if test="updatedTime != null ">
				 ,updated_time = #{updatedTime,jdbcType=TIMESTAMP}
		</if>
		<if test="lastVersion != null and lastVersion !=''">
				 ,last_version = #{lastVersion,jdbcType=VARCHAR}
		</if>
		<if test="status != null and status !=''">
				 ,status = #{status,jdbcType=VARCHAR}
		</if>
		<if test="trigger != null and trigger !=''">
				 ,trigger = #{trigger,jdbcType=VARCHAR}
		</if>
		<if test="objects != null and objects !=''">
				 ,objects = #{objects,jdbcType=VARCHAR}
		</if>
		where template_id = #{templateId,jdbcType=VARCHAR}
	</update>
	
	<update id="updateInstanceById" parameterType="com.cloud.api.dto.AppInstanceDTO">
		update instance set display_name = #{displayName,jdbcType=VARCHAR},
		description = #{description,jdbcType=VARCHAR}
		<if test="updatedTime != null ">
				 ,updated_time = #{updatedTime,jdbcType=TIMESTAMP}
		</if>
		<if test="lastVersion != null and lastVersion !=''">
				 ,last_version = #{lastVersion,jdbcType=VARCHAR}
		</if>
		<if test="status != null and status !=''">
				 ,status = #{status,jdbcType=VARCHAR}
		</if>
		<if test="trigger != null and trigger !=''">
				 ,trigger = #{trigger,jdbcType=VARCHAR}
		</if>
		<if test="objects != null and objects !=''">
				 ,objects = #{objects,jdbcType=VARCHAR}
		</if>
		where uuid = #{uuid,jdbcType=VARCHAR}
	</update>
	
	<select id="countByExample" parameterType="com.cloud.api.dto.AppInstanceDTOExample" resultType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select count(*) from instance
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    </select>
    
    <select id="selectByExample" parameterType="com.cloud.api.dto.AppInstanceDTOExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from instance
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
	
</mapper>